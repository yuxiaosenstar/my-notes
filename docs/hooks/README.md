---
title: æµ…è°ˆï¼šä¸ºå•¥vueå’Œreactéƒ½é€‰æ‹©äº†HooksğŸ‚ï¼Ÿ
sidebar: 'auto'
---

## ğŸ“–é˜…è¯»æœ¬æ–‡ï¼Œä½ å°†:

1. åˆæ­¥äº†è§£ Hooks åœ¨ vue ä¸ react çš„ç°çŠ¶

2. å¬ä¸€å¬æœ¬æ–‡ä½œè€…å…³äº Hooks çš„å®šä¹‰å’Œæ€»ç»“

3. å¼„æ‡‚â€œä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ Hooksâ€

4. è¿›è¡Œä¸€äº›ç®€å•çš„ Hooks å®è·µ

## ä¸€ã€hooks: ä»€ä¹ˆå«å¤§åŠ¿æ‰€è¶‹ï¼Ÿ

2019å¹´å¹´åˆï¼Œreact åœ¨ 16.8.x ç‰ˆæœ¬æ­£å¼å…·å¤‡äº† hooks èƒ½åŠ›ã€‚
2019å¹´6æœˆï¼Œå°¤é›¨æºªåœ¨ [vue/github-issues](https://github.com/vuejs/rfcs/pull/42) é‡Œæå‡ºäº†å…³äº vue3 Component API çš„ææ¡ˆã€‚ï¼ˆvue hooksçš„åŸºç¡€ï¼‰
åœ¨åç»­çš„ react å’Œ vue3 ç›¸å…³ç‰ˆæœ¬ä¸­ï¼Œç›¸å…³ hooks èƒ½åŠ›éƒ½å¼€å§‹è¢«æ›´å¤šäººæ‰€æ¥å—ã€‚
é™¤æ­¤ä¹‹å¤–ï¼Œsolid.jsã€ preact ç­‰æ¡†æ¶ï¼Œä¹Ÿæ˜¯å¼€å§‹é€‰æ‹©åŠ å…¥ hooks å¤§å®¶åº­ã€‚

![](media/16919191050984/16919191975258.jpg)

å¯ä»¥é¢„è§ï¼Œè™½ç„¶ç›®å‰ä»ç„¶æ˜¯ class Component å’Œ hooks api å¹¶é©¾é½é©±çš„åœºé¢ï¼Œä½†æœªæ¥å‡ å¹´é‡Œï¼Œhooks ææœ‰å¯èƒ½å–ä»£ class Component æˆä¸ºä¸šå†…çœŸæ­£çš„ä¸»æµã€‚

## äºŒã€ä»€ä¹ˆæ˜¯ hooksï¼Ÿ

> å¹´è½»æ—¶ä½ ä¸æ‡‚æˆ‘ï¼Œå°±åƒåæ¥æˆ‘ä¸æ‡‚ hooksğŸ˜­ã€‚

### 2.1 hooks çš„å®šä¹‰

"hooks" ç›´è¯‘æ˜¯ â€œé’©å­â€ï¼Œå®ƒå¹¶ä¸ä»…æ˜¯ reactï¼Œç”šè‡³ä¸ä»…æ˜¯å‰ç«¯ç•Œçš„ä¸“ç”¨æœ¯è¯­ï¼Œè€Œæ˜¯æ•´ä¸ªè¡Œä¸šæ‰€ç†ŸçŸ¥çš„ç”¨è¯­ã€‚é€šå¸¸æŒ‡ï¼š

> ç³»ç»Ÿè¿è¡Œåˆ°æŸä¸€æ—¶æœŸæ—¶ï¼Œä¼šè°ƒç”¨è¢«æ³¨å†Œåˆ°è¯¥æ—¶æœºçš„å›è°ƒå‡½æ•°ã€‚

æ¯”è¾ƒå¸¸è§çš„é’©å­æœ‰ï¼šwindows ç³»ç»Ÿçš„é’©å­èƒ½ç›‘å¬åˆ°ç³»ç»Ÿçš„å„ç§äº‹ä»¶ï¼Œæµè§ˆå™¨æä¾›çš„ onload æˆ– addEventListener èƒ½æ³¨å†Œåœ¨æµè§ˆå™¨å„ç§æ—¶æœºè¢«è°ƒç”¨çš„æ–¹æ³•ã€‚

ä»¥ä¸Šè¿™äº›ï¼Œéƒ½å¯ä»¥è¢«ç§°ä¸€å£° "hook"ã€‚
ä½†æ˜¯å¾ˆæ˜¾ç„¶ï¼Œåœ¨ç‰¹å®šé¢†åŸŸçš„ç‰¹å®šè¯é¢˜ä¸‹ï¼Œhooks è¿™ä¸ªè¯è¢«èµ‹äºˆäº†ä¸€äº›ç‰¹æ®Šçš„å«ä¹‰ã€‚
åœ¨ react@16.x ä¹‹å‰ï¼Œå½“æˆ‘ä»¬è°ˆè®º hooks æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½è°ˆè®ºçš„æ˜¯â€œç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸâ€ã€‚
ä½†æ˜¯ç°åœ¨ï¼Œhooks åˆ™æœ‰äº†å…¨æ–°çš„å«ä¹‰ã€‚
ä»¥ react ä¸ºä¾‹ï¼Œhooks æ˜¯ï¼š

> ä¸€ç³»åˆ—ä»¥ â€œuseâ€ ä½œä¸ºå¼€å¤´çš„æ–¹æ³•ï¼Œå®ƒä»¬æä¾›äº†è®©ä½ å¯ä»¥å®Œå…¨é¿å¼€ classå¼å†™æ³•ï¼Œåœ¨å‡½æ•°å¼ç»„ä»¶ä¸­å®Œæˆç”Ÿå‘½å‘¨æœŸã€çŠ¶æ€ç®¡ç†ã€é€»è¾‘å¤ç”¨ç­‰å‡ ä¹å…¨éƒ¨ç»„ä»¶å¼€å‘å·¥ä½œçš„èƒ½åŠ›ã€‚

ç®€åŒ–ä¸€ä¸‹ï¼š

> ä¸€ç³»åˆ—æ–¹æ³•ï¼Œæä¾›äº†åœ¨å‡½æ•°å¼ç»„ä»¶ä¸­å®Œæˆå¼€å‘å·¥ä½œçš„èƒ½åŠ›ã€‚

ï¼ˆè®°ä½è¿™ä¸ªå…³é”®è¯: å‡½æ•°å¼ç»„ä»¶ï¼‰

```js
import { useState, useEffect, useCallback } from 'react';
// æ¯”å¦‚ä»¥ä¸Šè¿™å‡ ä¸ªæ–¹æ³•ï¼Œå°±æ˜¯æœ€ä¸ºå…¸å‹çš„ Hooks
```

è€Œåœ¨ vue ä¸­ï¼Œ hooks çš„å®šä¹‰å¯èƒ½æ›´æ¨¡ç³Šï¼Œå§‘ä¸”æ€»ç»“ä¸€ä¸‹ï¼š

> åœ¨ vue ç»„åˆå¼APIé‡Œï¼Œä»¥ â€œuseâ€ ä½œä¸ºå¼€å¤´çš„ï¼Œä¸€ç³»åˆ—æä¾›äº†ç»„ä»¶å¤ç”¨ã€çŠ¶æ€ç®¡ç†ç­‰å¼€å‘èƒ½åŠ›çš„æ–¹æ³•ã€‚

ï¼ˆå…³é”®è¯ï¼šç»„åˆå¼APIï¼‰

```js
import { useSlots, useAttrs } from 'vue';
import { useRouter } from 'vue-router';
// ä»¥ä¸Šè¿™äº›æ–¹æ³•ï¼Œä¹Ÿæ˜¯ vue3 ä¸­ç›¸å…³çš„ Hookï¼
```

å¦‚ï¼šuseSlotsã€ useAttrsã€ useRouter ç­‰ã€‚
ä½†ä¸»è§‚æ¥è¯´ï¼Œæˆ‘è®¤ä¸ºvue ç»„åˆå¼APIå…¶æœ¬èº«å°±æ˜¯â€œvue hooksâ€çš„å…³é”®ä¸€ç¯ï¼Œèµ·åˆ°äº† react hooksé‡Œå¯¹ç”Ÿå‘½å‘¨æœŸã€çŠ¶æ€ç®¡ç†çš„æ ¸å¿ƒä½œç”¨ã€‚ï¼ˆå¦‚ onMountedã€ ref ç­‰ç­‰ï¼‰ã€‚

![](media/16919191050984/16919193841065.jpg)

å¦‚æœæŒ‰è¿™ä¸ªæ ‡å‡†æ¥çœ‹çš„è¯ï¼Œvue å’Œ react ä¸­ hooks çš„å®šä¹‰ï¼Œä¼¼ä¹éƒ½å·®ä¸å¤šã€‚

é‚£ä¹ˆä¸ºä»€ä¹ˆè¦æåˆ°æ˜¯ä»¥ â€œuseâ€ ä½œä¸ºå¼€å¤´çš„æ–¹æ³•å‘¢ï¼Ÿ

### 2.2 å‘½åè§„èŒƒ å’Œ æŒ‡å¯¼æ€æƒ³

é€šå¸¸æ¥è¯´ï¼Œhooks çš„å‘½åéƒ½æ˜¯ä»¥ use ä½œä¸ºå¼€å¤´ï¼Œè¿™ä¸ªè§„èŒƒä¹ŸåŒ…æ‹¬äº†é‚£ä¹ˆæˆ‘ä»¬è‡ªå®šä¹‰çš„ hooksã€‚

ä¸ºä»€ä¹ˆï¼Ÿ

å› ä¸º ~~ï¼ˆçˆ±æƒ… è¯¯ï¼‰~~ çº¦å®šã€‚

åœ¨ react å®˜æ–¹æ–‡æ¡£é‡Œï¼Œå¯¹ hooks çš„å®šä¹‰å’Œä½¿ç”¨æå‡ºäº† `â€œä¸€ä¸ªå‡è®¾ã€ä¸¤ä¸ªåªåœ¨â€` æ ¸å¿ƒæŒ‡å¯¼æ€æƒ³ã€‚~~ï¼ˆæ’­éŸ³è…”ï¼‰~~

![](media/16919191050984/16919194689736.jpg)

ä¸€ä¸ªå‡è®¾ï¼š å‡è®¾ä»»ä½•ä»¥ ã€Œuseã€ å¼€å¤´å¹¶ç´§è·Ÿç€ä¸€ä¸ªå¤§å†™å­—æ¯çš„å‡½æ•°å°±æ˜¯ä¸€ä¸ª Hookã€‚
ç¬¬ä¸€ä¸ªåªåœ¨ï¼š åªåœ¨ React å‡½æ•°ç»„ä»¶ä¸­è°ƒç”¨ Hookï¼Œè€Œä¸åœ¨æ™®é€šå‡½æ•°ä¸­è°ƒç”¨ Hookã€‚ï¼ˆEslint é€šè¿‡åˆ¤æ–­ä¸€ä¸ªæ–¹æ³•æ˜¯ä¸æ˜¯å¤§å¨å³°å‘½åæ¥åˆ¤æ–­å®ƒæ˜¯å¦æ˜¯ React å‡½æ•°ï¼‰
ç¬¬äºŒä¸ªåªåœ¨ï¼š åªåœ¨æœ€é¡¶å±‚ä½¿ç”¨ Hookï¼Œè€Œä¸è¦åœ¨å¾ªç¯ï¼Œæ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨ Hookã€‚
å› ä¸ºæ˜¯çº¦å®šï¼Œå› è€Œ useXxx çš„å‘½åå¹¶éå¼ºåˆ¶ï¼Œä½ ä¾ç„¶å¯ä»¥å°†ä½ è‡ªå®šä¹‰çš„ hook å‘½åä¸º byXxx æˆ–å…¶ä»–æ–¹å¼ï¼Œä½†ä¸æ¨èã€‚
å› ä¸ºçº¦å®šçš„åŠ›é‡åœ¨äºï¼šæˆ‘ä»¬ä¸ç”¨ç»†çœ‹å®ç°ï¼Œä¹Ÿèƒ½é€šè¿‡å‘½åæ¥äº†è§£ä¸€ä¸ªå®ƒæ˜¯ä»€ä¹ˆã€‚
ä»¥ä¸Š â€œä¸€ä¸ªå‡è®¾ã€ä¸¤ä¸ªåªåœ¨â€ æ€»ç»“è‡ª react å®˜ç½‘ï¼š

1. https://link.juejin.cn/?target=https%3A%2F%2Fzh-hans.reactjs.org%2Fdocs%2Fhooks-rules.html
2. https://link.juejin.cn/?target=https%3A%2F%2Fzh-hans.reactjs.org%2Fdocs%2Fhooks-faq.html%23what-exactly-do-the-lint-rules-enforce

## ä¸‰ã€ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ hooks ?

### 3.1 æ›´å¥½çš„çŠ¶æ€å¤ç”¨

> æ€¼çš„å°±æ˜¯ä½ ï¼Œmixin ï¼

åœ¨ class ç»„ä»¶æ¨¡å¼ä¸‹ï¼ŒçŠ¶æ€é€»è¾‘çš„å¤ç”¨æ˜¯ä¸€ä»¶å›°éš¾çš„äº‹æƒ…ã€‚

å‡è®¾æœ‰å¦‚ä¸‹éœ€æ±‚ï¼š

> å½“ç»„ä»¶å®ä¾‹åˆ›å»ºæ—¶ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ª state å±æ€§ï¼šnameï¼Œå¹¶éšæœºç»™æ­¤ name å±æ€§é™„ä¸€ä¸ªåˆå§‹å€¼ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¾—æä¾›ä¸€ä¸ª setName æ–¹æ³•ã€‚ä½ å¯ä»¥åœ¨ç»„ä»¶å…¶ä»–åœ°æ–¹å¼€é”€å’Œä¿®æ”¹æ­¤çŠ¶æ€å±æ€§ã€‚
> æ›´é‡è¦çš„æ˜¯: è¿™ä¸ªé€»è¾‘è¦å¯ä»¥å¤ç”¨ï¼Œåœ¨å„ç§ä¸šåŠ¡ç»„ä»¶é‡Œå¤ç”¨è¿™ä¸ªé€»è¾‘ã€‚

åœ¨æ‹¥æœ‰ Hooks ä¹‹å‰ï¼Œæˆ‘é¦–å…ˆä¼šæƒ³åˆ°çš„è§£å†³æ–¹æ¡ˆä¸€å®šæ˜¯ mixinã€‚

ä»£ç å¦‚ä¸‹ï¼šï¼ˆæ­¤ç¤ºä¾‹é‡‡ç”¨ vue2 mixin å†™æ³• ï¼‰

```js
// æ··å…¥æ–‡ä»¶ï¼šname-mixin.js
export default {
  data() {
    return {
      name: genRandomName() // å‡è£…å®ƒèƒ½ç”Ÿæˆéšæœºçš„åå­—
    }
  },
  methods: {
    setName(name) {
      this.name = name
    }
  }
}
```

```jsx
// ç»„ä»¶ï¼šmy-component.vue
<template>
  <div>{{ name }}</div>
<template>
<script>
import nameMixin from './name-mixin';
export default {
  mixins: [nameMixin],
  // é€šè¿‡mixins, ä½ å¯ä»¥ç›´æ¥è·å¾— nameMixin ä¸­æ‰€å®šä¹‰çš„çŠ¶æ€ã€æ–¹æ³•ã€ç”Ÿå‘½å‘¨æœŸä¸­çš„äº‹ä»¶ç­‰
  mounted() {
    setTimeout(() => {
      this.setName('Tom')
    }, 3000)
  }
}
<script>
```

ç²—ç•¥çœ‹æ¥ï¼Œmixins ä¼¼ä¹æä¾›äº†éå¸¸ä¸é”™çš„å¤ç”¨èƒ½åŠ›ï¼Œä½†æ˜¯ï¼Œreactå®˜æ–¹æ–‡æ¡£ç›´æ¥è¡¨æ˜ï¼š

![](media/16919191050984/16919196180762.jpg)

ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

å› ä¸º mixins è™½ç„¶æä¾›äº†è¿™ç§çŠ¶æ€å¤ç”¨çš„èƒ½åŠ›ï¼Œä½†å®ƒçš„å¼Šç«¯å®åœ¨å¤ªå¤šäº†ã€‚

å¼Šç«¯ä¸€ï¼šéš¾ä»¥è¿½æº¯çš„æ–¹æ³•ä¸å±æ€§ï¼

è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœå‡ºç°è¿™ç§ä»£ç ï¼Œä½ æ˜¯å¦ä¼šæ€€ç–‘äººç”Ÿï¼š

```js
export default {
  mixins: [ a, b, c, d, e, f, g ], // å½“ç„¶ï¼Œè¿™åªæ˜¯è¡¨ç¤ºå®ƒæ··å…¥äº†å¾ˆå¤šèƒ½åŠ›
  mounted() {
    console.log(this.name)
    // mmp!è¿™ä¸ª this.name æ¥è‡ªäºè°ï¼Ÿæˆ‘éš¾é“è¦ä¸€ä¸ªä¸ªæ··å…¥çœ‹å®ç°ï¼Ÿ
  }
}
```

åˆæˆ–è€…ï¼š

```js
a.js mixins: [b.js]

b.js mixins: [c.js]

c.js mixins: [d.js]

// ä½ çŒœçŒœçœ‹, this.name æ¥è‡ªäºè°ï¼Ÿ
// æ±‚æ±‚ä½ åˆ«å†è¯´äº†ï¼Œæˆ‘è¡€å‹å·²ç»ä¸Šæ¥äº†
```

å¼Šç«¯äºŒï¼šè¦†ç›–ã€åŒåï¼Ÿè´µåœˆçœŸä¹±ï¼

å½“æˆ‘åŒæ—¶æƒ³æ··å…¥ mixin-a.js å’Œ mixin-b.js ä»¥åŒæ—¶è·å¾—å®ƒä»¬èƒ½åŠ›çš„æ—¶å€™ï¼Œä¸å¹¸çš„äº‹æƒ…å‘ç”Ÿäº†ï¼š
ç”±äºè¿™ä¸¤ä¸ª mixin åŠŸèƒ½çš„å¼€å‘è€…æƒºæƒºç›¸æƒœï¼Œå®ƒä»¬éƒ½å®šä¹‰äº† this.name ä½œä¸ºå±æ€§ã€‚
è¿™ç§æ—¶å€™ï¼Œä½ ä¼šæ·±æ·±æ€€ç–‘ï¼Œmixins ç©¶ç«Ÿæ˜¯ä¸æ˜¯ä¸€ç§ç§‘å­¦çš„å¤ç”¨æ–¹å¼ã€‚

å¼Šç«¯ä¸‰ï¼šæ¢…å¼€äºŒåº¦ï¼Ÿä»£ä»·å¾ˆå¤§ï¼

ä»ç„¶è¯´ä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚æœæˆ‘çš„éœ€æ±‚å‘ç”Ÿäº†æ”¹å˜ï¼Œæˆ‘éœ€è¦çš„ä¸å†æ˜¯ä¸€ä¸ªç®€å•çš„çŠ¶æ€ nameï¼Œè€Œæ˜¯åˆ†åˆ«éœ€è¦ firstName å’Œ lastNameã€‚
æ­¤æ—¶ name-mixin.js æ··å…¥çš„èƒ½åŠ›å°±ä¼šéå¸¸å°´å°¬ï¼Œå› ä¸ºæˆ‘æ— æ³•ä¸¤æ¬¡ mixins åŒä¸€ä¸ªæ–‡ä»¶ã€‚
å½“ç„¶ï¼Œä¹Ÿæ˜¯æœ‰è§£å†³æ–¹æ¡ˆçš„ï¼Œå¦‚ï¼š

```js
// åŠ¨æ€ç”Ÿæˆmixin
function genNameMixin(key, funcKey) {
  return {
    data() {
      return {
        [key]: genRandomName()
      }
    },
    methods: {
      [funcKey]: function(v) {
        this.[key] = v
      } 
    }
  }
}

export default {
  mixins: [
    genNameMixin('firstName', 'setFirstName'),
    genNameMixin('lastName', 'setLastName'),
  ]
}
```

ç¡®å®é€šè¿‡åŠ¨æ€ç”Ÿæˆ mixin å®Œæˆäº†èƒ½åŠ›çš„å¤ç”¨ï¼Œä½†è¿™æ ·ä¸€æ¥ï¼Œæ— ç–‘æ›´åŠ åœ°å¢å¤§äº†ç¨‹åºçš„å¤æ‚æ€§ï¼Œé™ä½äº†å¯è¯»æ€§ã€‚

å› æ­¤ï¼Œä¸€ç§æ–°çš„ â€œçŠ¶æ€é€»è¾‘å¤ç”¨â€ å°±å˜å¾—æä¸ºè¿«åˆ‡äº†â€”â€”å®ƒå°±æ˜¯ Hooks!

Hook çš„çŠ¶æ€å¤ç”¨å†™æ³•ï¼š

```js
// å•ä¸ªnameçš„å†™æ³•
const { name, setName } = useName();

// æ¢…å¼€äºŒåº¦çš„å†™æ³•
const { name : firstName, setName : setFirstName } = useName();

const { name : secondName, setName : setSecondName } = useName();
```

ç›¸æ¯”äº mixinsï¼Œå®ƒä»¬ç®€ç›´å¤ªæ£’äº†ï¼

1. æ–¹æ³•å’Œå±æ€§å¥½è¿½æº¯å—ï¼Ÿè¿™å¯å¤ªå¥½äº†ï¼Œè°äº§ç”Ÿçš„ï¼Œå“ªå„¿æ¥çš„ä¸€ç›®äº†ç„¶ã€‚
2. ä¼šæœ‰é‡åã€è¦†ç›–é—®é¢˜å—ï¼Ÿå®Œå…¨æ²¡æœ‰ï¼å†…éƒ¨çš„å˜é‡åœ¨é—­åŒ…å†…ï¼Œè¿”å›çš„å˜é‡æ”¯æŒå®šä¹‰åˆ«åã€‚
3. å¤šæ¬¡ä½¿ç”¨ï¼Œæ²¡å¼€Nåº¦ï¼Ÿä½ çœ‹ä¸Šé¢çš„ä»£ç å—å†…ä¸å°±â€œæ¢…å¼€ä¸‰åº¦â€ äº†å—ï¼Ÿ

å°±å†² `â€œçŠ¶æ€é€»è¾‘å¤ç”¨â€` è¿™ä¸ªç†ç”±ï¼ŒHooks å°±å·²ç»é¦™å¾—æˆ‘å£æ°´ç›´æµäº†ã€‚

### 3.2 ä»£ç ç»„ç»‡

> ç†µå‡ï¼Œå®‡å®™å“²å­¦åˆ°ç¼–ç å“²å­¦ã€‚

é¡¹ç›®ã€æ¨¡å—ã€é¡µé¢ã€åŠŸèƒ½ï¼Œå¦‚ä½•é«˜æ•ˆè€Œæ¸…æ™°åœ°ç»„ç»‡ä»£ç ï¼Œè¿™ä¸€ä¸ªçœ‹ä¼¼ç®€å•çš„å‘½é¢˜å°±ç®—å†™å‡ æœ¬ä¹¦ä¹Ÿæ— æ³•å®Œå…¨è¯´æ¸…æ¥šã€‚
ä½†ä¸€ä¸ªé¡µé¢ä¸­ï¼ŒNä»¶äº‹æƒ…çš„ä»£ç åœ¨ä¸€ä¸ªç»„ä»¶å†…äº’ç›¸çº ç¼ ç¡®å®æ˜¯åœ¨ Hooks å‡ºç°ä¹‹å‰éå¸¸å¸¸è§çš„ä¸€ç§çŠ¶æ€ã€‚
é‚£ä¹ˆ Hooks å†™æ³•åœ¨ä»£ç ç»„ç»‡ä¸Šç©¶ç«Ÿèƒ½å¸¦æ¥æ€æ ·çš„æå‡å‘¢ï¼Ÿ

![](media/16919191050984/16919197640815.jpg)

ï¼ˆå‡è®¾ä¸Šå›¾ä¸­æ¯ä¸€ç§é¢œè‰²å°±ä»£ç ä¸€ç§é«˜åº¦ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘ï¼‰
æ— è®ºæ˜¯ vue è¿˜æ˜¯ react, é€šè¿‡ Hooks å†™æ³•éƒ½èƒ½åšåˆ°ï¼Œå°†â€œåˆ†æ•£åœ¨å„ç§å£°æ˜å‘¨æœŸé‡Œçš„ä»£ç å—â€ï¼Œé€šè¿‡ Hooks çš„æ–¹å¼å°†ç›¸å…³çš„å†…å®¹èšåˆåˆ°ä¸€èµ·ã€‚
è¿™æ ·å¸¦æ¥çš„å¥½å¤„æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼šâ€œé«˜åº¦èšåˆï¼Œå¯é˜…è¯»æ€§æå‡â€ã€‚ä¼´éšè€Œæ¥çš„ä¾¿æ˜¯ â€œæ•ˆç‡æå‡ï¼Œbugå˜å°‘â€ã€‚
æŒ‰ç…§â€œç‰©ç†å­¦â€é‡Œçš„ç†è®ºæ¥è¯´ï¼Œè¿™ç§ä»£ç ç»„ç»‡æ–¹å¼ï¼Œå°±ç®—æ˜¯â€œç†µå‡â€äº†ã€‚

### 3.3 æ¯” class ç»„ä»¶æ›´å®¹æ˜“ç†è§£

> å°¤å…¶æ˜¯ this ã€‚

åœ¨ react çš„ class å†™æ³•ä¸­ï¼Œéšå¤„å¯è§å„ç§å„æ ·çš„ .bind(this)ã€‚ï¼ˆç”šè‡³å®˜æ–¹æ–‡æ¡£é‡Œä¹Ÿæœ‰ä¸“é—¨çš„ç« èŠ‚æè¿°äº†â€œä¸ºä»€ä¹ˆç»‘å®šæ˜¯å¿…è¦çš„ï¼Ÿâ€è¿™ä¸€é—®é¢˜ï¼‰
vue ç©å®¶åˆ«ç¬‘ï¼Œcomputed: { a: () => { this } } é‡Œçš„ this ä¹Ÿæ˜¯ undefinedã€‚
å¾ˆæ˜¾ç„¶ï¼Œç»‘å®šè™½ç„¶â€œå¿…è¦â€ï¼Œä½†å¹¶ä¸æ˜¯â€œä¼˜ç‚¹â€ï¼Œåè€Œæ˜¯â€œæ•…éšœé«˜å‘â€åœ°æ®µã€‚
ä½†åœ¨Hooks å†™æ³•ä¸­ï¼Œä½ å°±å®Œå…¨ä¸å¿…æ‹…å¿ƒ this çš„é—®é¢˜äº†ã€‚

å› ä¸ºï¼š

> æœ¬æ¥æ— ä¸€ç‰©ï¼Œä½•å¤„æƒ¹å°˜åŸƒã€‚

Hooks å†™æ³•ç›´æ¥å‘Šåˆ«äº† thisï¼Œä»â€œå‡½æ•°â€æ¥ï¼Œåˆ°â€œå‡½æ•°â€å»ã€‚

å¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘å¿˜è®°å†™ bind äº†ã€‚

### 3.4 å‹å¥½çš„æ¸è¿›å¼

> éšé£æ½œå…¥å¤œï¼Œæ¶¦ç‰©ç»†æ— å£°ã€‚

æ¸è¿›å¼çš„å«ä¹‰æ˜¯ï¼šä½ å¯ä»¥ä¸€ç‚¹ç‚¹æ·±å…¥ä½¿ç”¨ã€‚
æ— è®ºæ˜¯ vue è¿˜æ˜¯ reactï¼Œéƒ½åªæ˜¯æä¾›äº† Hooks APIï¼Œå¹¶å°†å®ƒä»¬çš„ä¼˜åŠ£åˆ©å¼Šæ‘†åœ¨äº†é‚£é‡Œã€‚å¹¶æ²¡æœ‰é€šè¿‡æ— æ³•æ¥å—çš„ break change æ¥å¼ºè¿«ä½ å¿…é¡»ä½¿ç”¨ Hooks å»æ”¹å†™ä¹‹å‰çš„ class ç»„ä»¶ã€‚
ä½ ä¾ç„¶å¯ä»¥åœ¨é¡¹ç›®é‡Œä¸€è¾¹å†™ class ç»„ä»¶ï¼Œä¸€è¾¹å†™ Hooks ç»„ä»¶ï¼Œåœ¨é¡¹ç›®çš„æ¼”è¿›å’Œå¼€å‘è¿‡ç¨‹ä¸­ï¼Œè¿™æ˜¯ä¸€ä»¶æ²¡æœ‰ç—›æ„Ÿï¼Œå´æ‚„æ— å£°æ¯æ”¹å˜ç€ä¸€åˆ‡çš„äº‹æƒ…ã€‚
ä½†æ˜¯äº‹æƒ…å‘å±•çš„è¶‹åŠ¿å´å¾ˆæ˜æ˜¾ï¼Œè¶Šæ¥è¶Šå¤šçš„äººåŠ å…¥äº† Hooks å’Œ ç»„åˆå¼API çš„å¤§å†›ã€‚

## å››ã€å¦‚ä½•å¼€å§‹ç© hooks ï¼Ÿ

### 4.1 ç¯å¢ƒå’Œç‰ˆæœ¬

åœ¨ react é¡¹ç›®ä¸­ï¼Œ react çš„ç‰ˆæœ¬éœ€è¦é«˜äº 16.8.0ã€‚

è€Œåœ¨ vue é¡¹ç›®ä¸­ï¼Œ vue3.x æ˜¯æœ€å¥½çš„é€‰æ‹©ï¼Œä½† vue2.6+ é…åˆ @vue/composition-apiï¼Œä¹Ÿå¯ä»¥å¼€å§‹äº«å—â€œç»„åˆå¼APIâ€çš„å¿«ä¹ã€‚

### 4.2 react çš„ Hooks å†™æ³•

å› ä¸º react Hooks ä»…æ”¯æŒâ€œå‡½æ•°å¼â€ç»„ä»¶ï¼Œå› æ­¤éœ€è¦åˆ›å»ºä¸€ä¸ªå‡½æ•°å¼ç»„ä»¶ my-component.jsã€‚

```jsx
// my-component.js
import { useState, useEffect } from 'React'

export default () => {
  // é€šè¿‡ useState å¯ä»¥åˆ›å»ºä¸€ä¸ª çŠ¶æ€å±æ€§ å’Œä¸€ä¸ªèµ‹å€¼æ–¹æ³•
  const [ name, setName ] = useState('')

  // é€šè¿‡ useEffect å¯ä»¥å¯¹å‰¯ä½œç”¨è¿›è¡Œå¤„ç†
  useEffect(() => {
    console.log(name)
  }, [ name ])

  // é€šè¿‡ useMemo èƒ½ç”Ÿæˆä¸€ä¸ªä¾èµ– name çš„å˜é‡ message
  const message = useMemo(() => {
    return `hello, my name is ${name}`
  }, [name])

  return <div>{ message }</div>
}
```

ç»†èŠ‚å¯å‚è€ƒ react å®˜æ–¹ç½‘ç«™ï¼šhttps://link.juejin.cn/?target=https%3A%2F%2Freact.docschina.org%2Fdocs%2Fhooks-intro.html

### 4.3 vue çš„ Hooks å†™æ³•

vue çš„ Hooks å†™æ³•ä¾èµ–äº ç»„åˆå¼APIï¼Œå› æ­¤æœ¬ä¾‹é‡‡ç”¨ `<script setup>` æ¥å†™ï¼š

```jsx
<template>
  <div>
    {{ message }}
  </div>
</template>
<script setup>
import { computed, ref } from 'vue'
// å®šä¹‰äº†ä¸€ä¸ª ref å¯¹è±¡
const name = ref('')
// å®šä¹‰äº†ä¸€ä¸ªä¾èµ– name.value çš„è®¡ç®—å±æ€§
const message = computed(() => {
  return `hello, my name is ${name.value}`
})
</script>
```

å¾ˆæ˜æ˜¾ï¼Œvue ç»„åˆå¼APIé‡Œå®Œæˆ useState å’Œ useMemo ç›¸å…³å·¥ä½œçš„ API å¹¶æ²¡æœ‰é€šè¿‡ useXxx æ¥å‘½åï¼Œè€Œæ˜¯éµä»äº† Vue ä¸€è„‰ç›¸æ‰¿è€Œæ¥çš„ ref å’Œ computedã€‚
è™½ç„¶ä¸ç¬¦åˆ react Hook å®šä¹‰çš„ Hook çº¦å®šï¼Œä½† vue çš„ api ä¸æŒ‰ç…§ react çš„çº¦å®šå¥½åƒä¹Ÿå¹¶æ²¡æœ‰ä»€ä¹ˆä¸å¦¥ã€‚

å‚è€ƒç½‘å€ï¼šhttps://link.juejin.cn/?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fapi%2Fcomposition-api.html

## äº”ã€å¼€å§‹ç¬¬ä¸€ä¸ªè‡ªå®šä¹‰ hook

é™¤äº†å®˜æ–¹æä¾›çš„ Hooks Api, Hooks çš„å¦å¤–ä¸€ä¸ªé‡è¦ç‰¹è´¨ï¼Œå°±æ˜¯å¯ä»¥è‡ªå·±è¿›è¡Œâ€œè‡ªå®šä¹‰ Hooksâ€ çš„å®šä¹‰ï¼Œä»è€Œå®ŒæˆçŠ¶æ€é€»è¾‘çš„å¤ç”¨ã€‚
å¼€æºç¤¾åŒºä¹Ÿéƒ½æœ‰å¾ˆå¤šä¸é”™çš„åŸºäº Hooks çš„å°è£…ï¼Œæ¯”å¦‚ ahooks (ahooks.js.org/zh-CN/)ï¼Œåˆæ¯”å¦‚ vueuseï¼ˆvueuse.org/ï¼‰

æˆ‘è¿˜ä¸“é—¨å†™è¿‡ä¸€ç¯‡å°æ–‡ç« ä»‹ç» vuehook:[ã€ä¸€åº“ã€‘vueuse:æˆ‘ä¸è®¸èº«ä¸ºvuer,ä½ çš„å·¥å…·é›†åªæœ‰lodash!](https://juejin.cn/post/7030395303433863205)ã€‚

![](media/16919191050984/16919199650954.jpg)

é‚£ä¹ˆï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆå¼€å§‹æ’°å†™ â€œè‡ªå®šä¹‰Hooksâ€ å‘¢ï¼Ÿå¾€ä¸‹çœ‹å§ï¼

### 5.1 react ç©å®¶çœ‹è¿™é‡ŒğŸ‘ˆ

react å®˜æ–¹ç½‘ç«™å°±ä¸“é—¨æœ‰ä¸€ä¸ªç« èŠ‚è®²è¿°â€œè‡ªå®šä¹‰Hookâ€ã€‚(https://link.juejin.cn/?target=https%3A%2F%2Freact.docschina.org%2Fdocs%2Fhooks-custom.html)

è¿™é‡Œï¼Œæˆ‘ä»¬æ‰”ç”¨æ–‡ç« å¼€å¤´é‚£ä¸ª useName çš„éœ€æ±‚ä¸ºä¾‹ï¼Œå¸Œæœ›è¾¾åˆ°æ•ˆæœï¼š

```js
const { name, setName } = useName();
// éšæœºç”Ÿæˆä¸€ä¸ªçŠ¶æ€å±æ€§ nameï¼Œå®ƒæœ‰ä¸€ä¸ªéšæœºåä½œä¸ºåˆå§‹å€¼
// å¹¶ä¸”æä¾›äº†ä¸€ä¸ªå¯éšæ—¶æ›´æ–°è¯¥å€¼çš„æ–¹æ³• setName
```

å¦‚æœæˆ‘ä»¬è¦å®ç°ä¸Šé¢æ•ˆæœï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆå†™ä»£ç å‘¢ï¼Ÿ

```js
import React from 'react';

export const useName = () => {
  // è¿™ä¸ª useMemo å¾ˆå…³é”®
  const randomName = React.useMemo(() => genRandomName(), []);
  const [ name, setName ] = React.useState(randomName)

  return {
    name,
    setName
  }
}
```

å¿ä¸ä½è¦å†æ¬¡æ„Ÿå¹ä¸€æ¬¡ï¼Œå’Œ mixins ç›¸æ¯”ï¼Œå®ƒä¸ä»…ä½¿ç”¨èµ·æ¥æ›´æ£’ï¼Œå°±è¿å®šä¹‰èµ·æ¥ä¹Ÿé‚£ä¹ˆç®€å•ã€‚

å¯èƒ½æœ‰æœ‹å‹ä¼šå¥½å¥‡ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥è¿™æ ·å†™ï¼š

```js
const [ name, setName ] = React.useState(genRandomName())
```

å› ä¸ºè¿™æ ·å†™æ˜¯ä¸å¯¹çš„ï¼Œæ¯æ¬¡ä½¿ç”¨è¯¥ Hook çš„å‡½æ•°ç»„ä»¶è¢«æ¸²æŸ“ä¸€æ¬¡æ—¶ï¼ŒgenRandom() æ–¹æ³•å°±ä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œè™½ç„¶ä¸å½±å“ name çš„å€¼ï¼Œä½†å­˜åœ¨æ€§èƒ½æ¶ˆè€—ï¼Œç”šè‡³äº§ç”Ÿå…¶ä»– bugã€‚

ä¸ºæ­¤ï¼Œæˆ‘å†™äº†ä¸€ä¸ªèƒ½å¤ç°é”™è¯¯çš„demoï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥ç‚¹å¼€éªŒè¯ï¼šhttps://link.juejin.cn/?target=https%3A%2F%2Fcodesandbox.io%2Fs%2Flong-cherry-kzcbqr

> 2022-02-03æ—¥è¡¥å……æ›´æ­£ï¼šç»æ˜å‹æé†’ï¼Œå¯ä»¥é€šè¿‡ React.useState(() => randomName()) ä¼ å‚æ¥é¿å…é‡å¤æ‰§è¡Œï¼Œè¿™æ ·å°±ä¸éœ€è¦ useMemo äº†ï¼Œæ„Ÿè°¢ï¼

### 5.2 vue ç©å®¶çœ‹è¿™é‡ŒğŸ‘ˆ

vue3 å®˜ç½‘æ²¡æœ‰å…³äº è‡ªå®šä¹‰Hook çš„ç©æ³•ä»‹ç»ï¼Œä½†å®è·µèµ·æ¥ä¹Ÿå¹¶ä¸å›°éš¾ã€‚

ç›®æ ‡ä¹Ÿå®šä½å®ç°ä¸€ä¸ª useName æ–¹æ³•ï¼š

```js
import { ref } from 'vue';

export const useName = () => {
  const name = ref(genRandomName())
  const setName = (v) => {
    name.value = v
  }
  return {
    name,
    setName
  }
}
```

### 5.3 vue å’Œ react è‡ªå®šä¹‰ Hook çš„å¼‚åŒ

* ç›¸ä¼¼ç‚¹ï¼š æ€»ä½“æ€è·¯æ˜¯ä¸€è‡´çš„
éƒ½éµç…§ç€ "å®šä¹‰çŠ¶æ€æ•°æ®"ï¼Œ"æ“ä½œçŠ¶æ€æ•°æ®"ï¼Œ"éšè—ç»†èŠ‚" ä½œä¸ºæ ¸å¿ƒæ€è·¯ã€‚

* å·®å¼‚ç‚¹ï¼š ç»„åˆå¼API å’Œ Reactå‡½æ•°ç»„ä»¶ æœ‰ç€æœ¬è´¨å·®å¼‚
vue3 çš„ç»„ä»¶é‡Œï¼Œ setup æ˜¯ä½œä¸ºä¸€ä¸ªæ—©äº â€œcreatedâ€ çš„ç”Ÿå‘½å‘¨æœŸå­˜åœ¨çš„ï¼Œæ— è®ºå¦‚ä½•ï¼Œåœ¨ä¸€ä¸ªç»„ä»¶çš„æ¸²æŸ“è¿‡ç¨‹ä¸­åªä¼šè¿›å…¥ä¸€æ¬¡ã€‚
Reactå‡½æ•°ç»„ä»¶ åˆ™å®Œå…¨ä¸åŒï¼Œå¦‚æœæ²¡æœ‰è¢« memorizedï¼Œå®ƒä»¬å¯èƒ½ä¼šè¢«ä¸åœåœ°è§¦å‘ï¼Œä¸åœåœ°è¿›å…¥å¹¶æ‰§è¡Œæ–¹æ³•ï¼Œå› æ­¤éœ€è¦å¼€é”€çš„å¿ƒæ™ºç›¸æ¯”äºvueå…¶å®æ˜¯æ›´å¤šçš„ã€‚



