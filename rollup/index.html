<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Rollup 简易实现 | 前端工程师成长路线</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="博客 分享 读后感 成长规划">
    <meta itemprop="name" content="前端工程师成长路线">
    
    <link rel="preload" href="/my-notes/assets/css/0.styles.2e5dbfbb.css" as="style"><link rel="preload" href="/my-notes/assets/js/app.79676a12.js" as="script"><link rel="preload" href="/my-notes/assets/js/7.bc002170.js" as="script"><link rel="preload" href="/my-notes/assets/js/2.9099f50b.js" as="script"><link rel="preload" href="/my-notes/assets/js/1.900df4bc.js" as="script"><link rel="preload" href="/my-notes/assets/js/33.7471a01e.js" as="script"><link rel="prefetch" href="/my-notes/assets/js/10.f353db48.js"><link rel="prefetch" href="/my-notes/assets/js/11.04270c4b.js"><link rel="prefetch" href="/my-notes/assets/js/14.f317941c.js"><link rel="prefetch" href="/my-notes/assets/js/15.857cf130.js"><link rel="prefetch" href="/my-notes/assets/js/16.5bb30ee7.js"><link rel="prefetch" href="/my-notes/assets/js/17.71bcb1cc.js"><link rel="prefetch" href="/my-notes/assets/js/18.ffb91de9.js"><link rel="prefetch" href="/my-notes/assets/js/19.0c910ac9.js"><link rel="prefetch" href="/my-notes/assets/js/20.03c82018.js"><link rel="prefetch" href="/my-notes/assets/js/21.bf53aff6.js"><link rel="prefetch" href="/my-notes/assets/js/22.9f954690.js"><link rel="prefetch" href="/my-notes/assets/js/23.8af55653.js"><link rel="prefetch" href="/my-notes/assets/js/24.1f0dcb2c.js"><link rel="prefetch" href="/my-notes/assets/js/25.72b8dd0c.js"><link rel="prefetch" href="/my-notes/assets/js/26.bb83b703.js"><link rel="prefetch" href="/my-notes/assets/js/27.e5c77e62.js"><link rel="prefetch" href="/my-notes/assets/js/28.647833ad.js"><link rel="prefetch" href="/my-notes/assets/js/29.8ce79ac0.js"><link rel="prefetch" href="/my-notes/assets/js/3.c6c75cd5.js"><link rel="prefetch" href="/my-notes/assets/js/30.e9fb2f67.js"><link rel="prefetch" href="/my-notes/assets/js/31.1c59b5dd.js"><link rel="prefetch" href="/my-notes/assets/js/32.6f6f8de1.js"><link rel="prefetch" href="/my-notes/assets/js/34.7b314bb9.js"><link rel="prefetch" href="/my-notes/assets/js/35.fda383fc.js"><link rel="prefetch" href="/my-notes/assets/js/36.c1953c43.js"><link rel="prefetch" href="/my-notes/assets/js/37.9cb3ab33.js"><link rel="prefetch" href="/my-notes/assets/js/38.7199786b.js"><link rel="prefetch" href="/my-notes/assets/js/39.a92f6447.js"><link rel="prefetch" href="/my-notes/assets/js/4.1f27c99d.js"><link rel="prefetch" href="/my-notes/assets/js/40.fb5a535f.js"><link rel="prefetch" href="/my-notes/assets/js/41.0b7312ed.js"><link rel="prefetch" href="/my-notes/assets/js/42.8e89ba9e.js"><link rel="prefetch" href="/my-notes/assets/js/43.a5bcbf68.js"><link rel="prefetch" href="/my-notes/assets/js/44.afd978bd.js"><link rel="prefetch" href="/my-notes/assets/js/45.8a7f2ddb.js"><link rel="prefetch" href="/my-notes/assets/js/46.6f6334b2.js"><link rel="prefetch" href="/my-notes/assets/js/47.cf02921b.js"><link rel="prefetch" href="/my-notes/assets/js/48.a97b5796.js"><link rel="prefetch" href="/my-notes/assets/js/49.b7aa10b6.js"><link rel="prefetch" href="/my-notes/assets/js/5.ddb6bfa2.js"><link rel="prefetch" href="/my-notes/assets/js/50.ad415512.js"><link rel="prefetch" href="/my-notes/assets/js/51.7efc6f81.js"><link rel="prefetch" href="/my-notes/assets/js/52.717af511.js"><link rel="prefetch" href="/my-notes/assets/js/53.1385e501.js"><link rel="prefetch" href="/my-notes/assets/js/54.f3e12e7b.js"><link rel="prefetch" href="/my-notes/assets/js/55.03f2aca2.js"><link rel="prefetch" href="/my-notes/assets/js/56.e0dc72e8.js"><link rel="prefetch" href="/my-notes/assets/js/57.f16c53e0.js"><link rel="prefetch" href="/my-notes/assets/js/58.e2433a99.js"><link rel="prefetch" href="/my-notes/assets/js/59.be8ecb87.js"><link rel="prefetch" href="/my-notes/assets/js/6.13b5e223.js"><link rel="prefetch" href="/my-notes/assets/js/60.6e101f6f.js"><link rel="prefetch" href="/my-notes/assets/js/61.1e24154a.js"><link rel="prefetch" href="/my-notes/assets/js/62.429185af.js"><link rel="prefetch" href="/my-notes/assets/js/63.155cb7eb.js"><link rel="prefetch" href="/my-notes/assets/js/64.4853d328.js"><link rel="prefetch" href="/my-notes/assets/js/65.ac711393.js"><link rel="prefetch" href="/my-notes/assets/js/66.8313c79f.js"><link rel="prefetch" href="/my-notes/assets/js/67.5e883df0.js"><link rel="prefetch" href="/my-notes/assets/js/68.acbdb51a.js"><link rel="prefetch" href="/my-notes/assets/js/69.73b4236c.js"><link rel="prefetch" href="/my-notes/assets/js/8.50d727e9.js"><link rel="prefetch" href="/my-notes/assets/js/9.a8f39d5e.js"><link rel="prefetch" href="/my-notes/assets/js/vendors~docsearch.5bf76089.js">
    <link rel="stylesheet" href="/my-notes/assets/css/0.styles.2e5dbfbb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>前端工程师成长路线</h3> <p class="description" data-v-59e6cb88>博客 分享 读后感 成长规划</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2024
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/my-notes/" class="home-link router-link-active"><!----> <span class="site-name">前端工程师成长路线</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/yuxiaosenstar/my-notes" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><!----> <!----> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>32</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>0</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"> <a href="https://github.com/yuxiaosenstar/my-notes" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <ul class="sidebar-links"><li><a href="/my-notes/rollup/" aria-current="page" class="active sidebar-link">Rollup 简易实现</a></li><li><a href="/my-notes/mysql/" class="sidebar-link">MySQL 的使用</a></li><li><a href="/my-notes/css/" class="sidebar-link">CSS — BEM 命名规范</a></li><li><a href="/my-notes/array/" class="sidebar-link">JavaScript 数组去重的方法（12 种方法，史上最全</a></li><li><a href="/my-notes/array/methods.html" class="sidebar-link">超级详细的 js数组方法详解</a></li><li><a href="/my-notes/task/" class="sidebar-link">宏任务和微任务到底是什么？</a></li><li><a href="/my-notes/permission/" class="sidebar-link">前端面试必备——权限控制</a></li><li><a href="/my-notes/tree/" class="sidebar-link">树形结构扁平化</a></li><li><a href="/my-notes/element/" class="sidebar-link">关于element form的表单验证</a></li><li><a href="/my-notes/mockjs/" class="sidebar-link">Mockjs 使用</a></li><li><a href="/my-notes/hooks/" class="sidebar-link">浅谈：为啥vue和react都选择了Hooks🏂？</a></li><li><a href="/my-notes/capture/" class="sidebar-link">浅谈两种前端截图方式：Canvas 截图 vs SVG 截图</a></li><li><a href="/my-notes/maven/" class="sidebar-link">maven</a></li><li><a href="/my-notes/eslint/" class="sidebar-link">ESLint 的 parser 是个什么东西</a></li><li><a href="/my-notes/lodash/" class="sidebar-link">Lodash 个人使用文档</a></li><li><a href="/my-notes/bom/" class="sidebar-link">强缓存与协商缓存</a></li><li><a href="/my-notes/js/" class="sidebar-link">节流和防抖的区别，以及如何实现</a></li><li><a href="/my-notes/flex/" class="sidebar-link">Flex 布局</a></li><li><a href="/my-notes/npm/" class="sidebar-link">离线环境安装npm包</a></li><li><a href="/my-notes/express/" class="sidebar-link">node.js使用express自动搭建项目</a></li><li><a href="/my-notes/vue/" class="sidebar-link">Vue为何采用异步渲染</a></li><li><a href="/my-notes/vue/comp.html" class="sidebar-link">vue父子组件的渲染顺序</a></li><li><a href="/my-notes/vue/ts.html" class="sidebar-link">vue-property-decorator用法</a></li><li><a href="/my-notes/vue/vue2.7.html" class="sidebar-link">vue2.7+vite+ts实践</a></li><li><a href="/my-notes/vue/standard.html" class="sidebar-link">Vue 前端代码风格指南</a></li><li><a href="/my-notes/js/null.html" class="sidebar-link">JavaScript中的“null”与“undefined“</a></li><li><a href="/my-notes/bom/history.html" class="sidebar-link">Html5 history对象详解</a></li><li><a href="/my-notes/vue/cdn.html" class="sidebar-link">vue项目中使用CDN引入</a></li><li><a href="/my-notes/vue/lazy.html" class="sidebar-link">vue实现路由懒加载（异步加载）及组件懒加载（异步加载）的方式</a></li><li><a href="/my-notes/vue/elementui.html" class="sidebar-link">Vue 项目中按需引入 ElementUI 的正确方法</a></li><li><a href="/my-notes/bom/cookie.html" class="sidebar-link">前端cookie和session</a></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>Rollup 简易实现</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2024
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">Rollup 简易实现</h1> <div data-v-8a445198><!----> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><p>随着前端生态的不断发展，以及前端工程化持续不断迭代升级，提升整体研发效率成为了前端研发团队里面所有成员都无法忽视的问题，业界也不断涌现出了越来越多的方案。</p> <p>比如在“构建”这个方向上，Vue 作者尤雨溪代领团队开发的新一代构建工具 Vite 开始进入大家的视野，在整个前端社区也得到了热烈的讨论。</p> <blockquote><p>Vite 是一种新型前端构建工具，能够显著提升前端开发体验。它主要由两部分组成：
一个开发服务器，基于原生 ES 模块提供了丰富的内建功能，如速度非常快的模块热更新（HMR）
一套构建指令，使用 Rollup 打包你的代码，并且它是预配置的，可输出用于生产环境的高度优化过的静态资源</p></blockquote> <p>这里就出现了我今天给大家分享的主角：Rollup。</p> <p>Rollup 的了解是至关重要的，不仅是因为 Vite 采用 Rollup 来打包；还有一些场景，比如我们想要编写一些 Vite 插件的时候，也需要对 Rollup 有一定的了解和积累。这是因为 Vite 插件是在 Rollup 的基础上进行扩展的，也就是在 Rollup 的基础上增加了一些 Vite 独有的配置项。除此之外，在 Webpack 占领绝大多数前端工程构建选型的今天，Rollup 仍然是许多主流 JS 库的打包方案，包括我们目前熟悉的 Vue、React 等主流框架。</p> <p>究竟 Rollup 的优势和特点体现在哪里呢？又要如何应用呢？让我们来详细地了解一下。</p> <h3 id="rollup-是什么"><a href="#rollup-是什么" class="header-anchor">#</a> Rollup 是什么</h3> <h3 id="rollup-定位"><a href="#rollup-定位" class="header-anchor">#</a> Rollup 定位</h3> <p>Rollup 的定位是一个用于 JavaScript 的模块打包器；而 Webpack 的定位是 JavaScript 应用程序的模块打包器。下面是引用了在 Rollup 和 Webpack 官方文档上对各自的定义。</p> <blockquote><p>// Rollup
Rollup is a module bundler for JavaScript which compiles small pieces of code into something larger and more complex, such as a library or application.<br>
// Webpack
At its core, webpack is a static module bundler for modern JavaScript applications.</p></blockquote> <p>Rollup 解决的问题</p> <p>在 ES6 模块化标准还没有推出时，前端模块化方案百花齐放，各大社区都产出了一些模块化的标准规范及对应实现，比如 CommonJS、CMD、AMD 等。但我们也遇到了一些实际困扰，比如在不同场景出现的各种问题，就需要使用不同的模块化方式来应对。</p> <p>而随着 ES6 Module（模块化）规范的提出，Rollup 提供了一种解决方案，使用 ES6 中的代码模块化方式，有力推进了模块化方式的统一。</p> <p>那 Rollup 具体做了什么样的事情呢？首先 Rollup 支持在使用 ES6 模块化规范编写代码时，打包生成符合各个环境和规范标准的代码；而且还可以优化精简引用的包中没有用到的代码，只保留代码中需要的部分；此外，Rollup 在工程化静态资源的构建上也在逐步积累。</p> <h3 id="对比-webpack-与-rollup-的打包效果"><a href="#对比-webpack-与-rollup-的打包效果" class="header-anchor">#</a> 对比 Webpack 与 Rollup 的打包效果</h3> <p>为了方便你了解 Rollup 的特点，我选择用 Webpack 4.x 来和 Rollup 2.58 来做一个对比。</p> <p>在如下的代码中，我写了两个方法 add 和 sub 来实现数字间的加减法计算，然后调用了其中的 sub 方法进行数字相减。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// modules/export</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">+</span> b

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">sub</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">-</span> b

<span class="token comment">// main.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> sub <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../modules/export'</span>

<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
</code></pre></div><p>我们来看下打包结果分别是什么样的。</p> <p>Webpack</p> <p><img src="/my-notes/assets/img/image.17d0ab41.png" alt="alt text"></p> <p>Rollup</p> <p><img src="/my-notes/assets/img/image-1.c0d1fe31.png" alt="alt text"></p> <p>你可以看到，Webpack 打包的代码不够精简，注入代码较多，可读性也不是很好，导致体积略大；而 Rollup 打包过程就简洁很多了。</p> <p>同时，这里有个小补充。你可以看到我们写的 add 方法并没有被打包进来，这个就是 tree-shaking 功能。Rollup 是较早提出 tree-shaking 概念的，Webpack 是在 4.0 之后开始支持，不过在多级关系引入时表现不如 Rollup 优秀，于是在 Webpack5 中又进一步优化了这个能力。因为今天我们要聚焦于如何使用 Rollup，所以就不去详细介绍这部分的概念了，如果你感兴趣可以主动了解一下，也可以在评论区分享你的心得。</p> <p>还有个题外话要说，大家学习 Rollup 时尽量选择看英文官方文档，因为 Rollup 的部分中文文档质量比较差而且更新也相对滞后。</p> <h3 id="如何使用-rollup"><a href="#如何使用-rollup" class="header-anchor">#</a> 如何使用 Rollup</h3> <p>Rollup 环境安装配置</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">--global</span> rollup
</code></pre></div><p>Rollup 基础使用示例</p> <ul><li><p>用命令行来执行 rollup src/main.js -o bundle.js -f cjs，其中</p> <ul><li><p>src/main.js 是入口文件</p></li> <li><p>-o 选项是 --output.file 的缩写，意思是把编译的结果保存在当前文件夹的 bundle.js 文件中</p></li> <li><p>-f 选项是--output.format 的缩写指定了所创建 bundle 的类型，cjs 是 CommonJS</p></li></ul></li></ul> <p>如果添加更多的选项，这种命令行的方式就显得麻烦了。所以我们可以通过写配置文件的方式来设置更丰富的选项功能，在项目的根目录创建 rollup.config.js 或者自定义一个文件路径及名称，然后通过 --config 或 -c 来使用配置文件。</p> <p>Rollup 的配置文件中主要的属性就是 input、output、plugin、external。</p> <h3 id="input"><a href="#input" class="header-anchor">#</a> Input</h3> <p>首先是打包的入口 input，我们可以设定为三种类型：字符串、字符串数组及对象。第一种当然就是单一入口的情况，如果不是单一入口的话，它们将被分别打包到单独的文件中。</p> <p>下面我分别演示下三种参数的写法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 字符串类型设置单一入口</span>
<span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token string">'src/main.js'</span>

<span class="token comment">// 字符串数组</span>
<span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'src/a.js'</span><span class="token punctuation">,</span> <span class="token string">'src/b.js'</span><span class="token punctuation">]</span>

<span class="token comment">// 对象</span>
<span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token string">'src/a.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token string">'src/b.js'</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="output"><a href="#output" class="header-anchor">#</a> Output</h3> <p>与 input 对应，output 就是打包的出口。output 还包含了 file、format、dir、globals、name、plugins、sourcemap 等常用的属性，这些属性分别设置打包输出的文件、输出的类型、多文件展示、打包的名称，还有 output 对应的 plugins、设置是否生成 sourcemap 等。其中的 format 是设置生成包的格式，默认是 es，还有 amd、cjs、es、iife、umd、system 这几种类型可以选择，下面我分别介绍一下。</p> <ul><li><p>amd：异步模块定义，用于像 RequireJS 这样的模块加载器</p></li> <li><p>cjs：CommonJS，适用于 Node.js 和 Browserify/Webpack 等</p></li> <li><p>es：将软件包保存为 ES 模块文件，在现代浏览器中可以通过 <code>&lt;script type=&quot;module&quot;&gt;</code>标签引入</p></li> <li><p>iife：自执行功能，适合作为 <code>&lt;script&gt;</code> 标签包含。Tips：iife 代表立即调用的函数表达式</p></li> <li><p>umd：通用模块定义，集 amd，cjs 和 iife 为一体</p></li> <li><p>system：SystemJS 加载器格式</p></li></ul> <p>至于 globals，我们放在后面聊 external 时再介绍。其他的命令比较简单，就不一一展开了，我只举个例子。</p> <p>我们把上面提到的命令行 <code>rollup src/main.js -o bundle.js -f cjs</code> 用配置文件的方式改写：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// rollup.config.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token string">'src/main.js'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'cjs'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>output 还可以设置 plugins，因为有些插件是专门应用于输出的环节的。这些插件只能在 Rollup 的主要分析完成后才能修改代码。如果将不兼容的插件用作特定于输出的插件，Rollup 会报 warning。</p> <p>我用一个工作中比较常见的插件来举例，rollup-plugin-terser 可以帮助我们压缩代码。首先我们来安装这个 plugin：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev rollup-plugin-terser
</code></pre></div><p>然后我们将它写在配置文件中：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// rollup.config.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> terser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rollup-plugin-terser'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token string">'src/main.js'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">'dist/rollup.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'cjs'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">terser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="plugin"><a href="#plugin" class="header-anchor">#</a> Plugin</h3> <p>随着构建更复杂的 bundle，通常需要更大的灵活性，我们会更多的用到通过 npm 安装的模块，会通过 Babel 编译代码，还会使用 JSON 文件等等。以工作中比较常用的 ESlint 来举例，首先要先安装这个 plugin：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> @rollup/plugin-eslint --save-dev
</code></pre></div><p>或者：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">yarn</span> <span class="token function">add</span> <span class="token parameter variable">-D</span> @rollup/plugin-eslint
</code></pre></div><p>这里你可以看到，我们用的是 --save-dev 而不是 --save，这是因为代码实际生产执行时不依赖这个插件，只是在开发或打包时使用。
接下来我们在配置文件中加入 ESlint 插件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> terser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rollup-plugin-terser'</span>

<span class="token keyword">import</span> eslint <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-eslint'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token string">'src/main.js'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">'dist/rollup.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'cjs'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">terser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">eslint</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'eol-last'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token string">'always'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我可以选择直接在这里配置 ESlint 规则，也可以选择在根目录创建.eslintrc.*，以文件的形式设置 ESlint 配置，配置文件不需要额外的单独设置就可以自动被加载。</p> <p><img src="/my-notes/assets/img/image-2.14476a6b.png" alt="alt text"></p> <p>除了 ESlint 还有很多我们比较常用的 plugin。比如可以把 CommonJS 模块转换为 ES 模块的插件 commonjs；用 resolve 插件处理 node_modules 的模块；del 插件可以帮我们在打包之前删除掉之前生成的 dist 文件；用 babel 插件进行转码；用 replace 插件注入环境变量；typescript 插件进行 TS 的支持；用 server 插件在我们开发过程中建立 server，帮助我们进行实时调试；通过 livereload 插件来设置哪些文件发生变化时会触发更新等等。你可以在 rollup/awesome 找到推荐的插件列表和具体的用法。</p> <h3 id="external"><a href="#external" class="header-anchor">#</a> External</h3> <p>external 在 Webpack 也有对应的属性，主要用来声明哪些包是我们需要使用但不需要在打包时包含，这些包不会被打入到我们的包中。当我们设置 output 的 format 类型是 iife 或者 umd 格式时，需要配置 output.globals 提供全局变量名来替换外部导入。可能这样说比较抽象，让我来举个例子。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> terser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rollup-plugin-terser'</span>
<span class="token keyword">import</span> eslint <span class="token keyword">from</span> <span class="token string">'@rollup/plugin-eslint'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token string">'src/main.js'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">external</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'axios'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">'dist/rollup.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'cjs'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">globals</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">axios</span><span class="token operator">:</span> <span class="token string">'axios'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">terser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">eslint</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'eol-last'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token string">'always'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>或者我们可以用官方文档的例子，更容易理解一些。我们设定 jQuery 为 external 的一个属性，在 iife 模块化类型下提供 $ 作为全局访问变量名：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// rollup.config.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token punctuation">,</span>
  <span class="token literal-property property">external</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'jquery'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'iife'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'MyBundle'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">globals</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">jquery</span><span class="token operator">:</span> <span class="token string">'$'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="代码拆分"><a href="#代码拆分" class="header-anchor">#</a> 代码拆分</h3> <p>对于代码拆分，在动态加载或设置了多个入口文件时，Rollup 会自动将代码拆分成块，并且我们可以通过 output.manualChunks 选项明确告诉 Rollup 哪些模块要拆分成单独的块。</p> <p>为了使用代码拆分功能实现动态加载，也就是在需要执行函数时才加载对应的包，我们先修改 src/main.js，并动态加载 src/exportDemo.js，exportDemo 文件返回一个 string，代码比较简单就不展示了，只列举一下在 main.js 的代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/main.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./exportDemo.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> obj <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Rollup 将使用动态导入来创建一个仅按需加载的单独块。为了让 Rollup 知道第二个块的放置位置，我们通过 output.dir 来设置文件夹存放打包文件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// rollup.config.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token string">'src/main.js'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">dir</span><span class="token operator">:</span> <span class="token string">'dist'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'cjs'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/my-notes/assets/img/image-3.b1bb74a4.png" alt="alt text"></p> <p>我们运行命令可以看到在 dist 文件夹中生成了两个文件，一个 main.js，一个 exportDemo-d13e707d.js，这个名字其实是 exportDemo-[hash].js，这里 [hash] 是一个基于内容的哈希字符串。我们也可以通过指定 output.chunkFileNames 和 output.entryFileNames 选项来设置文件命名。举个例子吧，我设置了 chunkFileNames 和 entryFileNames，可以看下打包的结果：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// rollup.config.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token string">'src/main.js'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">dir</span><span class="token operator">:</span> <span class="token string">'dist'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'cjs'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">chunkFileNames</span><span class="token operator">:</span> <span class="token string">'hellorollup-chunk-[name]-[hash].js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">entryFileNames</span><span class="token operator">:</span> <span class="token string">'hellorollup-[name].js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/my-notes/assets/img/image-4.d64619b7.png" alt="alt text"></p> <p>这里你可以思考一下，如果有多个入口文件对同一个文件依赖，我们打包的结果会是什么样的？我们再添加一个入口文件 main1.js，在 main1.js 中我们同样引入 exportDemo.js 文件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/main1.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> obj <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./exportDemo.js'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>同时把 src/main1.js 也作为打包入口：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// rollup.config.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'src/main.js'</span><span class="token punctuation">,</span> <span class="token string">'src/main1.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">dir</span><span class="token operator">:</span> <span class="token string">'dist'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'cjs'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">chunkFileNames</span><span class="token operator">:</span> <span class="token string">'hellorollup-chunk-[name]-[hash].js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">entryFileNames</span><span class="token operator">:</span> <span class="token string">'hellorollup-[name].js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以看到打包之后创建了三个文件：</p> <p><img src="/my-notes/assets/img/image-5.fc1c764f.png" alt="alt text"></p> <p>我们来看下这两个入口文件是如何导入相同模块的。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//  dist/hellorollup-mian.js</span>

<span class="token string">'use strict'</span>

<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./hellorollup-chunk-exportDemo-39836610.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> obj <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> main

<span class="token comment">// dist/hellorollup-mian1.js</span>
<span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token string">'use strict'</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> exportDemo <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./hellorollup-chunk-exportDemo-39836610.js'</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">main1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>exportDemo<span class="token punctuation">[</span><span class="token string">'default'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> main1
</code></pre></div><p>代码拆分的另一个用途就是能够指定多个共享依赖项的入口文件，创建额外的模块，只加载必要的最少的资源。</p> <p>当然还可以用来帮助我们把代码打包为不同格式，以应对各个版本浏览器上不同的支持情况。比如我希望我的代码可以构建为 ES 模块文件和适用于 system.js 的格式，分别存放在 dist/es 和 dist/system 文件夹中。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// rollup.config.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token string">'src/main.js'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">dir</span><span class="token operator">:</span> <span class="token string">'dist/es'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'es'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">chunkFileNames</span><span class="token operator">:</span> <span class="token string">'hellorollup-chunk-[name]-[hash].js'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">entryFileNames</span><span class="token operator">:</span> <span class="token string">'hellorollup-[name].js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">dir</span><span class="token operator">:</span> <span class="token string">'dist/system'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'system'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">chunkFileNames</span><span class="token operator">:</span> <span class="token string">'hellorollup-chunk-[name]-[hash].js'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">entryFileNames</span><span class="token operator">:</span> <span class="token string">'hellorollup-[name].js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>来看下打包的结果，首先是目录结果：</p> <p><img src="/my-notes/assets/img/image-6.b539b504.png" alt="alt text"></p> <p>我们也看下打包出的结果，分别按照 es 格式和 system 格式生成了输出文件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// dist/es/hellorollup.main.js</span>
<span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./hellorollup-chunk-exportDemo-bae3d89c.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> obj <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> main <span class="token keyword">as</span> <span class="token keyword">default</span> <span class="token punctuation">}</span>

<span class="token comment">// dist/system/hellorollup.main.js</span>
System<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">'use strict'</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">execute</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">exports</span><span class="token punctuation">(</span><span class="token string">'default'</span><span class="token punctuation">,</span> main<span class="token punctuation">)</span>
      <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        module
          <span class="token punctuation">.</span><span class="token function">import</span><span class="token punctuation">(</span><span class="token string">'./hellorollup-chunk-exportDemo-8e5bfab8.js'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> obj <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这样我们就可以在 html 中用不同的方式引入：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> main <span class="token keyword">from</span> <span class="token string">'./dist/es/hellorollup-main.js'</span>
  <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  System<span class="token punctuation">.</span><span class="token function">import</span><span class="token punctuation">(</span><span class="token string">'./dist/system/hellorollup-main.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> main <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p>整体来说，Rollup 最核心的功能还是作为打包构建工具，优势是它的打包结果干净，配置也相对比 Webpack 简单，能让你更方便地结合和管理你的代码内容，无论是你自己编写的代码还是对你喜欢的库代码的引用。本文介绍了 Rollup 打包的一些比较基础常用的配置选项 input、output、external、plugin，也为大家介绍了一些常用的 plugin 和详细的用法。</p></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新时间: </span> <span class="time">2024-10-17 14:18:00</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/my-notes/mysql/">
          MySQL 的使用
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-3" data-v-b57cc07c><a href="/my-notes/rollup/#rollup-是什么" class="sidebar-link reco-side-rollup-是什么" data-v-b57cc07c>Rollup 是什么</a></li><li class="level-3" data-v-b57cc07c><a href="/my-notes/rollup/#rollup-定位" class="sidebar-link reco-side-rollup-定位" data-v-b57cc07c>Rollup 定位</a></li><li class="level-3" data-v-b57cc07c><a href="/my-notes/rollup/#对比-webpack-与-rollup-的打包效果" class="sidebar-link reco-side-对比-webpack-与-rollup-的打包效果" data-v-b57cc07c>对比 Webpack 与 Rollup 的打包效果</a></li><li class="level-3" data-v-b57cc07c><a href="/my-notes/rollup/#如何使用-rollup" class="sidebar-link reco-side-如何使用-rollup" data-v-b57cc07c>如何使用 Rollup</a></li><li class="level-3" data-v-b57cc07c><a href="/my-notes/rollup/#input" class="sidebar-link reco-side-input" data-v-b57cc07c>Input</a></li><li class="level-3" data-v-b57cc07c><a href="/my-notes/rollup/#output" class="sidebar-link reco-side-output" data-v-b57cc07c>Output</a></li><li class="level-3" data-v-b57cc07c><a href="/my-notes/rollup/#plugin" class="sidebar-link reco-side-plugin" data-v-b57cc07c>Plugin</a></li><li class="level-3" data-v-b57cc07c><a href="/my-notes/rollup/#external" class="sidebar-link reco-side-external" data-v-b57cc07c>External</a></li><li class="level-3" data-v-b57cc07c><a href="/my-notes/rollup/#代码拆分" class="sidebar-link reco-side-代码拆分" data-v-b57cc07c>代码拆分</a></li><li class="level-3" data-v-b57cc07c><a href="/my-notes/rollup/#总结" class="sidebar-link reco-side-总结" data-v-b57cc07c>总结</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/my-notes/assets/js/app.79676a12.js" defer></script><script src="/my-notes/assets/js/7.bc002170.js" defer></script><script src="/my-notes/assets/js/2.9099f50b.js" defer></script><script src="/my-notes/assets/js/1.900df4bc.js" defer></script><script src="/my-notes/assets/js/33.7471a01e.js" defer></script>
  </body>
</html>
